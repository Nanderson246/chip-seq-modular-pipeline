<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Overview – ChIP-seq Modular Analysis Pipeline</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-dec293facc5f57232bb73e2f627a5456.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/overview.html">Overview</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">ChIP-seq Modular Analysis Pipeline</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ChIP-seq Modular Analysis Pipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/overview.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">⚙️ Installation Guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/reference_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🧬 Initial documents and reference setups</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/pipeline1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🔄 Pipeline 1: QC &amp; Preprocessing Modules</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/pipeline2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🔄 Pipeline 2: Peak Calling, Reproducibility, and Functional Annotation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing Modules</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/docker_pipeline1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐳 Running Pipeline1 with Docker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/docker_pipeline2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐳 Running Pipeline2 with Docker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/docker_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐳 Docker guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Conda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐍 Core enviroment:conda</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🧰 Software Requirements (Non-Docker Setup)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/citations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">📚 Tool Citations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">📄 MIT License</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> 🧬 Overview</a></li>
  <li><a href="#pipeline-components" id="toc-pipeline-components" class="nav-link" data-scroll-target="#pipeline-components"><span class="header-section-number">2</span> 📚 Pipeline Components</a>
  <ul class="collapse">
  <li><a href="#read-preprocessing-and-alignment" id="toc-read-preprocessing-and-alignment" class="nav-link" data-scroll-target="#read-preprocessing-and-alignment"><span class="header-section-number">2.1</span> 🔧 1. <strong>Read Preprocessing and Alignment</strong></a></li>
  </ul></li>
  <li><a href="#replicate-quality-control-with-deeptools" id="toc-replicate-quality-control-with-deeptools" class="nav-link" data-scroll-target="#replicate-quality-control-with-deeptools"><span class="header-section-number">3</span> 🔬 Replicate Quality Control with <strong>deepTools</strong></a>
  <ul class="collapse">
  <li><a href="#advantages-of-deeptools" id="toc-advantages-of-deeptools" class="nav-link" data-scroll-target="#advantages-of-deeptools"><span class="header-section-number">3.1</span> ✅ Advantages of deepTools:</a></li>
  <li><a href="#why-not-use-phantompeakqualtools" id="toc-why-not-use-phantompeakqualtools" class="nav-link" data-scroll-target="#why-not-use-phantompeakqualtools"><span class="header-section-number">3.2</span> ❓ Why not use <code>phantompeakqualtools</code>?</a></li>
  <li><a href="#signal-generation" id="toc-signal-generation" class="nav-link" data-scroll-target="#signal-generation"><span class="header-section-number">3.3</span> 📈 2. <strong>Signal Generation</strong></a></li>
  <li><a href="#peak-calling" id="toc-peak-calling" class="nav-link" data-scroll-target="#peak-calling"><span class="header-section-number">3.4</span> 📍 3. <strong>Peak Calling</strong></a></li>
  <li><a href="#idr-analysis" id="toc-idr-analysis" class="nav-link" data-scroll-target="#idr-analysis"><span class="header-section-number">3.5</span> 📊 4. <strong>IDR Analysis</strong></a></li>
  <li><a href="#patch-install-idr-numpy-compatibility" id="toc-patch-install-idr-numpy-compatibility" class="nav-link" data-scroll-target="#patch-install-idr-numpy-compatibility"><span class="header-section-number">3.6</span> 🛠 Patch + Install IDR (NumPy Compatibility)</a></li>
  <li><a href="#replicatepartition-concordance" id="toc-replicatepartition-concordance" class="nav-link" data-scroll-target="#replicatepartition-concordance"><span class="header-section-number">3.7</span> 🔁 5. <strong>Replicate/Partition Concordance</strong></a></li>
  <li><a href="#format-conversion-and-final-outputs" id="toc-format-conversion-and-final-outputs" class="nav-link" data-scroll-target="#format-conversion-and-final-outputs"><span class="header-section-number">3.8</span> 🧾 6. <strong>Format Conversion and Final Outputs</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Overview</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> 🧬 Overview</h2>
<p>This pipeline was developed and tested on Linux with POSIX-compliant behavior, macOS compatibility is not supported, If adjustments are needed for your system, you are free to modify the setup accordingly. This is the first version and still in beta test. However you can download and tested in your system as full package or use every modular script. The goal was to create a first Github project to establish Bioinformatic competence by the author.</p>
<p>This project implements a modular and reproducible <strong>ChIP-seq analysis pipeline</strong> designed for both human and mouse samples. The pipeline is organized into two main parts:</p>
<ol type="1">
<li><strong>Preprocessing and BAM Cleaning</strong> – Modular pipeline for data preparation.</li>
<li><strong>Peak Calling and Reproducibility Analysis</strong> – Peak detection, quality control, and IDR-based reproducibility assessment.</li>
</ol>
<p>The pipeline supports both <strong>HOMER</strong> and <strong>MACS3</strong> workflows, and uses metadata-based automation. Its structure mirrors the <strong>ENCODE ChIP-seq processing pipeline</strong>, providing a modular, standardized workflow to produce reproducible peak calls, generate signal tracks, and perform quality assessments such as IDR (Irreproducible Discovery Rate), while automating sample naming and grouping.</p>
<p>This package is intended to be flexible and modular. Each module can be customized by the user, or the pipeline can be run as-is. It is <strong>not a beginner-friendly pipeline</strong>, nor was it designed to be. The pipeline runs directly in Bash on a Linux system. Docker files are included to allow execution within containers, and a brief guide is provided at the end of this text, explaining how to build the container and mount the required folders properly.</p>
<p>To run this pipeline you will need to have your paired fastq.gz samples in the samples folder, a mapping.tsv data, and to set the reference files in the Reference folder and the spike reference genomes in the SpikeinReference folder.</p>
<p>The package provide two dataset test from GEO dataset to test Hg38 and mm10 samples.</p>
<p>Information about these two GEO datasets is provided in the README.md file inside the examples/ folder. The pipeline1 is adapted to automatically download an SRR_Acc_List.txt if the list in the metadata folder. We also provide the mapping.tsv as example</p>
<hr>
</section>
<section id="pipeline-components" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="pipeline-components"><span class="header-section-number">2</span> 📚 Pipeline Components</h2>
<section id="read-preprocessing-and-alignment" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="read-preprocessing-and-alignment"><span class="header-section-number">2.1</span> 🔧 1. <strong>Read Preprocessing and Alignment</strong></h3>
<p><strong>Input:</strong> FASTQ files (<code>reads</code>)</p>
<p><strong>Tools Used:</strong></p>
<ul>
<li><code>cutadapt</code>: Adapter trimming</li>
<li><code>BWA</code>: Alignment to reference genome</li>
<li><code>Samtools</code>, <code>Picard</code>: Sorting, deduplication, indexing, BAM cleanup</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Unfiltered alignments</li>
<li>Filtered, deduplicated BAM files</li>
<li>Removal of excluded/blacklisted regions (e.g., ENCODE blacklist)</li>
</ul>
<hr>
</section>
</section>
<section id="replicate-quality-control-with-deeptools" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="replicate-quality-control-with-deeptools"><span class="header-section-number">3</span> 🔬 Replicate Quality Control with <strong>deepTools</strong></h2>
<p>This pipeline uses <strong>deepTools</strong> (e.g., <code>plotFingerprint</code>, <code>multiBamSummary</code>) to evaluate replicate quality.</p>
<section id="advantages-of-deeptools" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="advantages-of-deeptools"><span class="header-section-number">3.1</span> ✅ Advantages of deepTools:</h3>
<ul>
<li>🧪 <strong>Modern and actively maintained</strong> – compatible with recent Python environments</li>
<li>📊 <strong>Fingerprint and cross-correlation plots</strong> – assess ChIP enrichment and background</li>
<li>⚙️ <strong>Format flexibility</strong> – supports BAM and BigWig</li>
<li>🐳 <strong>Container-friendly</strong> – easy to integrate in Docker-based workflows</li>
<li>📁 <strong>Multi-sample analysis</strong> – supports <code>multiBamSummary</code>, <code>plotCorrelation</code></li>
</ul>
<p>Users can optionally replace this with <strong>Relative Strand Correlation (RSC)</strong> via the <strong>ChIPQC R package</strong> by editing the relevant module — showcasing the pipeline’s modularity.</p>
<hr>
</section>
<section id="why-not-use-phantompeakqualtools" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="why-not-use-phantompeakqualtools"><span class="header-section-number">3.2</span> ❓ Why not use <code>phantompeakqualtools</code>?</h3>
<p>Although once widely used to assess replicate quality, <code>phantompeakqualtools</code> is now:</p>
<ul>
<li>🛑 Outdated and no longer actively maintained</li>
<li>🐪 Depends on legacy Perl environments and outdated tools like CClang v5</li>
<li>🧱 Hard to containerize or integrate into modern pipelines</li>
</ul>
<p>Therefore, it has been replaced by more maintainable alternatives in this workflow.</p>
<hr>
</section>
<section id="signal-generation" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="signal-generation"><span class="header-section-number">3.3</span> 📈 2. <strong>Signal Generation</strong></h3>
<p><strong>Tools:</strong></p>
<ul>
<li>MACS3: Generates signal tracks (bedGraph or bigWig)</li>
<li>BEDTools: For further manipulation</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Signal p-value tracks</li>
<li>Fold change over control tracks</li>
</ul>
<hr>
</section>
<section id="peak-calling" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="peak-calling"><span class="header-section-number">3.4</span> 📍 3. <strong>Peak Calling</strong></h3>
<p><strong>Performed on:</strong></p>
<ul>
<li>Individual replicates</li>
<li>Pooled replicates</li>
<li>Pseudoreplicates</li>
</ul>
<p><strong>Tools:</strong></p>
<ul>
<li>MACS3 or HOMER</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Replicated peaks</li>
<li>Pooled peaks</li>
<li>Pseudoreplicated peaks</li>
</ul>
<hr>
</section>
<section id="idr-analysis" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="idr-analysis"><span class="header-section-number">3.5</span> 📊 4. <strong>IDR Analysis</strong></h3>
<p><strong>Tool:</strong> <a href="https://github.com/nboley/idr"><code>idr</code></a> — used to assess peak reproducibility</p>
<p>This pipeline uses a <strong>patched IDR version</strong> compatible with the latest <code>numpy</code>, avoiding the need to downgrade.</p>
<hr>
</section>
<section id="patch-install-idr-numpy-compatibility" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="patch-install-idr-numpy-compatibility"><span class="header-section-number">3.6</span> 🛠 Patch + Install IDR (NumPy Compatibility)</h3>
<pre><code>bash
    wget https://github.com/kundajelab/idr/archive/refs/tags/2.0.4.2.tar.gz &amp;&amp; \
    tar -xvf 2.0.4.2.tar.gz &amp;&amp; \
    cd idr-2.0.4.2/idr &amp;&amp; \
    sed -i 's/numpy.int/int/g' idr.py &amp;&amp; \
    cd .. &amp;&amp; \
    pip install . --break-system-packages &amp;&amp; \
    rm -rf /opt/idr-2.0.4.2 /opt/2.0.4.2.tar.gz</code></pre>
<p><strong>Outputs:</strong></p>
<ul>
<li>IDR-ranked peaks</li>
<li>IDR-thresholded peaks</li>
<li>Conservative IDR peaks</li>
</ul>
<hr>
</section>
<section id="replicatepartition-concordance" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="replicatepartition-concordance"><span class="header-section-number">3.7</span> 🔁 5. <strong>Replicate/Partition Concordance</strong></h3>
<p>Assesses consistency of peaks across replicates and pseudoreplicates.</p>
<hr>
</section>
<section id="format-conversion-and-final-outputs" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="format-conversion-and-final-outputs"><span class="header-section-number">3.8</span> 🧾 6. <strong>Format Conversion and Final Outputs</strong></h3>
<p>Covers conversion to final formats for visualization, downstream analysis, or submission.</p>
<hr>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>