<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ChIP-seq Modular Analysis Pipeline</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dec293facc5f57232bb73e2f627a5456.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      ChIP-seq Modular Analysis Pipeline
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">ChIP-seq Modular Analysis Pipeline</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ChIP-seq Modular Analysis Pipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">⚙️ Installation Guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/reference_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🧬 Initial documents and reference setups</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/pipeline1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🔄 Pipeline 1: QC &amp; Preprocessing Modules</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/pipeline2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🔄 Pipeline 2: Peak Calling, Reproducibility, and Functional Annotation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preprocessing Modules</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/docker_pipeline1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐳 Running Pipeline1 with Docker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/docker_pipeline2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐳 Running Pipeline2 with Docker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/docker_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐳 Docker guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/Conda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🐍 Core enviroment:conda</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">🧰 Software Requirements (Non-Docker Setup)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/citations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">📚 Tool Citations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./content/license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">📄 MIT License</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ChIP-seq Modular Analysis Pipeline</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="index" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> index</h1>
</section>
<section id="welcome" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 🧬 Welcome</h1>
<p>Welcome to the <strong>ChIP-seq Modular Analysis Pipeline</strong> documentation!</p>
<p>This site provides a detailed manual for running and understanding the modular ChIP-seq pipeline developed by <strong>Nancy Anderson</strong>. It includes setup, usage, modules, metadata structure, Docker/Conda environments, and more.</p>
<hr>
<section id="sections" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sections"><span class="header-section-number">2.1</span> 📚 Sections</h2>
<ul>
<li><p><a href="overview.qmd">Overview</a></p></li>
<li><p><a href="pipeline1.qmd">Pipeline 1: QC &amp; Preprocessing</a></p></li>
<li><p><a href="pipeline2.qmd">Pipeline 2: Peak Calling &amp; Analysis</a></p></li>
<li><p><a href="mapping.qmd">Metadata Guide</a></p></li>
<li><p><a href="docker_pipeline1.qmd">Docker Usage - Pipeline 1</a></p></li>
<li><p><a href="docker_pipeline2.qmd">Docker Usage - Pipeline 2</a></p></li>
<li><p><a href="docker_guide.qmd">Unified Docker Guide</a></p></li>
<li><p><a href="Conda.qmd">Conda Environment Setup</a></p></li>
<li><p><a href="software.qmd">Software Requirements</a></p></li>
<li><p><a href="troubleshooting.qmd">Troubleshooting</a></p></li>
<li><p><a href="citations.qmd">Citations</a></p></li>
<li><p><a href="license.qmd">License</a></p></li>
</ul>
<hr>
</section>
<section id="quick-start" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="quick-start"><span class="header-section-number">2.2</span> 🧪 Quick Start</h2>
<p>If you’re eager to run the pipeline quickly, jump to:</p>
<p>👉 <a href="overview.qmd#quick-start---requirements">Quick Start Guide</a></p>
<p>Or explore the <strong>Docker options</strong> for portable setup:</p>
<p>👉 <a href="docker_guide.qmd">Docker Setup</a></p>
<hr>
</section>
</section>
<section id="overview" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> overview</h1>
<p>title: “Overview”</p>
<section id="overview-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="overview-1"><span class="header-section-number">3.1</span> 🧬 Overview</h2>
<p>This pipeline was developed and tested on Linux with POSIX-compliant behavior, macOS compatibility is not supported, If adjustments are needed for your system, you are free to modify the setup accordingly. This is the first version and still in beta test. However you can download and tested in your system as full package or use every modular script. The goal was to create a first Github project to establish Bioinformatic competence by the author.</p>
<p>This project implements a modular and reproducible <strong>ChIP-seq analysis pipeline</strong> designed for both human and mouse samples. The pipeline is organized into two main parts:</p>
<ol type="1">
<li><strong>Preprocessing and BAM Cleaning</strong> – Modular pipeline for data preparation.</li>
<li><strong>Peak Calling and Reproducibility Analysis</strong> – Peak detection, quality control, and IDR-based reproducibility assessment.</li>
</ol>
<p>The pipeline supports both <strong>HOMER</strong> and <strong>MACS3</strong> workflows, and uses metadata-based automation. Its structure mirrors the <strong>ENCODE ChIP-seq processing pipeline</strong>, providing a modular, standardized workflow to produce reproducible peak calls, generate signal tracks, and perform quality assessments such as IDR (Irreproducible Discovery Rate), while automating sample naming and grouping.</p>
<p>This package is intended to be flexible and modular. Each module can be customized by the user, or the pipeline can be run as-is. It is <strong>not a beginner-friendly pipeline</strong>, nor was it designed to be. The pipeline runs directly in Bash on a Linux system. Docker files are included to allow execution within containers, and a brief guide is provided at the end of this text, explaining how to build the container and mount the required folders properly.</p>
<p>To run this pipeline you will need to have your paired fastq.gz samples in the samples folder, a mapping.tsv data, and to set the reference files in the Reference folder and the spike reference genomes in the SpikeinReference folder.</p>
<p>The package provide two dataset test from GEO dataset to test Hg38 and mm10 samples.</p>
<p>Information about these two GEO datasets is provided in the README.md file inside the examples/ folder. The pipeline1 is adapted to automatically download an SRR_Acc_List.txt if the list in the metadata folder. We also provide the mapping.tsv as example</p>
</section>
<section id="pipeline-components" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="pipeline-components"><span class="header-section-number">3.2</span> 📚 Pipeline Components</h2>
<section id="read-preprocessing-and-alignment" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="read-preprocessing-and-alignment"><span class="header-section-number">3.2.1</span> 🔧 1. <strong>Read Preprocessing and Alignment</strong></h3>
<p><strong>Input:</strong> FASTQ files (<code>reads</code>)</p>
<p><strong>Tools Used:</strong></p>
<ul>
<li><code>cutadapt</code>: Adapter trimming</li>
<li><code>BWA</code>: Alignment to reference genome</li>
<li><code>Samtools</code>, <code>Picard</code>: Sorting, deduplication, indexing, BAM cleanup</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Unfiltered alignments</li>
<li>Filtered, deduplicated BAM files</li>
<li>Removal of excluded/blacklisted regions (e.g., ENCODE blacklist)</li>
</ul>
</section>
</section>
<section id="replicate-quality-control-with-deeptools" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="replicate-quality-control-with-deeptools"><span class="header-section-number">3.3</span> 🔬 Replicate Quality Control with <strong>deepTools</strong></h2>
<p>This pipeline uses <strong>deepTools</strong> (e.g., <code>plotFingerprint</code>, <code>multiBamSummary</code>) to evaluate replicate quality.</p>
<section id="advantages-of-deeptools" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="advantages-of-deeptools"><span class="header-section-number">3.3.1</span> ✅ Advantages of deepTools:</h3>
<ul>
<li>🧪 <strong>Modern and actively maintained</strong> – compatible with recent Python environments</li>
<li>📊 <strong>Fingerprint and cross-correlation plots</strong> – assess ChIP enrichment and background</li>
<li>⚙️ <strong>Format flexibility</strong> – supports BAM and BigWig</li>
<li>🐳 <strong>Container-friendly</strong> – easy to integrate in Docker-based workflows</li>
<li>📁 <strong>Multi-sample analysis</strong> – supports <code>multiBamSummary</code>, <code>plotCorrelation</code></li>
</ul>
<p>Users can optionally replace this with <strong>Relative Strand Correlation (RSC)</strong> via the <strong>ChIPQC R package</strong> by editing the relevant module — showcasing the pipeline’s modularity.</p>
</section>
<section id="why-not-use-phantompeakqualtools" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="why-not-use-phantompeakqualtools"><span class="header-section-number">3.3.2</span> ❓ Why not use <code>phantompeakqualtools</code>?</h3>
<p>Although once widely used to assess replicate quality, <code>phantompeakqualtools</code> is now:</p>
<ul>
<li>🛑 Outdated and no longer actively maintained</li>
<li>🐪 Depends on legacy Perl environments and outdated tools like CClang v5</li>
<li>🧱 Hard to containerize or integrate into modern pipelines</li>
</ul>
<p>Therefore, it has been replaced by more maintainable alternatives in this workflow.</p>
</section>
<section id="signal-generation" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="signal-generation"><span class="header-section-number">3.3.3</span> 📈 2. <strong>Signal Generation</strong></h3>
<p><strong>Tools:</strong></p>
<ul>
<li>MACS3: Generates signal tracks (bedGraph or bigWig)</li>
<li>BEDTools: For further manipulation</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Signal p-value tracks</li>
<li>Fold change over control tracks</li>
</ul>
</section>
<section id="peak-calling" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="peak-calling"><span class="header-section-number">3.3.4</span> 📍 3. <strong>Peak Calling</strong></h3>
<p><strong>Performed on:</strong></p>
<ul>
<li>Individual replicates</li>
<li>Pooled replicates</li>
<li>Pseudoreplicates</li>
</ul>
<p><strong>Tools:</strong></p>
<ul>
<li>MACS3 or HOMER</li>
</ul>
<p><strong>Outputs:</strong></p>
<ul>
<li>Replicated peaks</li>
<li>Pooled peaks</li>
<li>Pseudoreplicated peaks</li>
</ul>
</section>
<section id="idr-analysis" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="idr-analysis"><span class="header-section-number">3.3.5</span> 📊 4. <strong>IDR Analysis</strong></h3>
<p><strong>Tool:</strong> <a href="https://github.com/nboley/idr"><code>idr</code></a> — used to assess peak reproducibility</p>
<p>This pipeline uses a <strong>patched IDR version</strong> compatible with the latest <code>numpy</code>, avoiding the need to downgrade.</p>
</section>
<section id="patch-install-idr-numpy-compatibility" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="patch-install-idr-numpy-compatibility"><span class="header-section-number">3.3.6</span> 🛠 Patch + Install IDR (NumPy Compatibility)</h3>
<pre><code>bash
    wget https://github.com/kundajelab/idr/archive/refs/tags/2.0.4.2.tar.gz &amp;&amp; \
    tar -xvf 2.0.4.2.tar.gz &amp;&amp; \
    cd idr-2.0.4.2/idr &amp;&amp; \
    sed -i 's/numpy.int/int/g' idr.py &amp;&amp; \
    cd .. &amp;&amp; \
    pip install . --break-system-packages &amp;&amp; \
    rm -rf /opt/idr-2.0.4.2 /opt/2.0.4.2.tar.gz</code></pre>
<p><strong>Outputs:</strong></p>
<ul>
<li>IDR-ranked peaks</li>
<li>IDR-thresholded peaks</li>
<li>Conservative IDR peaks</li>
</ul>
</section>
<section id="replicatepartition-concordance" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="replicatepartition-concordance"><span class="header-section-number">3.3.7</span> 🔁 5. <strong>Replicate/Partition Concordance</strong></h3>
<p>Assesses consistency of peaks across replicates and pseudoreplicates.</p>
</section>
<section id="format-conversion-and-final-outputs" class="level3" data-number="3.3.8">
<h3 data-number="3.3.8" class="anchored" data-anchor-id="format-conversion-and-final-outputs"><span class="header-section-number">3.3.8</span> 🧾 6. <strong>Format Conversion and Final Outputs</strong></h3>
<p>Covers conversion to final formats for visualization, downstream analysis, or submission.</p>
</section>
</section>
</section>
<section id="installation" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> installation</h1>
<p>title: “⚙️ Installation Guide”</p>
<section id="installation-overview" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="installation-overview"><span class="header-section-number">4.1</span> 📦 Installation Overview</h2>
<p>This guide explains how to set up the ChIP-seq Modular Analysis Pipeline using:</p>
<ul>
<li>✅ Git clone (recommended)</li>
<li>📁 <code>.tar.gz</code> or <code>.zip</code> archive download</li>
<li>🐳 Docker (see <a href="docker_guide.qmd">Docker Guide</a>)</li>
<li>🧪 Conda environments (see <a href="Conda.qmd">Conda Setup</a>)</li>
</ul>
</section>
<section id="option-1-clone-from-github" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="option-1-clone-from-github"><span class="header-section-number">4.2</span> 📂 Option 1: Clone from GitHub</h2>
<p>The most robust and update-safe method:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/your-username/your-repo.git</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> your-repo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="make-scripts-executable-already-github-executable-commit-but-in-case" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="make-scripts-executable-already-github-executable-commit-but-in-case"><span class="header-section-number">4.2.1</span> ✅ Make Scripts Executable (already github executable commit, but in case)</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x run_pipeline<span class="pp">*</span>.sh</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x modules/<span class="pp">**</span>/<span class="pp">*</span>.sh</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x modules/<span class="pp">**</span>/<span class="pp">*</span>.py</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x modules/<span class="pp">**</span>/<span class="pp">*</span>.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="option-2-download-archive" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="option-2-download-archive"><span class="header-section-number">4.3</span> 📦 Option 2: Download Archive</h2>
<section id="if-you-downloaded-the-.tar.gz-version" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="if-you-downloaded-the-.tar.gz-version"><span class="header-section-number">4.3.1</span> 🔸 If you downloaded the <code>.tar.gz</code> version:</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xzvf</span> your-pipeline.tar.gz</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> your-pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Scripts remain executable — no <code>chmod</code> needed.</p>
</section>
<section id="if-you-downloaded-the-.zip-version" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="if-you-downloaded-the-.zip-version"><span class="header-section-number">4.3.2</span> ⚠️ If you downloaded the <code>.zip</code> version:</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> your-pipeline.zip</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> your-pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then run:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x run_pipeline<span class="pp">*</span>.sh</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x modules/<span class="pp">**</span>/<span class="pp">*</span>.sh</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x modules/<span class="pp">**</span>/<span class="pp">*</span>.py</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x modules/<span class="pp">**</span>/<span class="pp">*</span>.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="test-the-installation" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="test-the-installation"><span class="header-section-number">4.4</span> ✅ Test the Installation</h2>
<p>Make sure the scripts work:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./run_pipeline1.sh</span> <span class="at">--help</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./run_pipeline2.sh</span> <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="expected-file-structure" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="expected-file-structure"><span class="header-section-number">4.5</span> 📁 Expected File Structure</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">your-repo/</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> run_pipeline1.sh</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> run_pipeline2.sh</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> modules/</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── pipeline1/</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── pipeline2/</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── utils/</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> metadata/</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> Reference/</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="related-setup-pages" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="related-setup-pages"><span class="header-section-number">4.6</span> 📚 Related Setup Pages</h2>
<ul>
<li>📦 <a href="reference_setup.qmd">Reference Setup</a></li>
<li>🧬 <a href="mapping.qmd">Metadata &amp; Mapping Format</a></li>
<li>🔧 <a href="software.qmd">Software Requirements</a></li>
<li>🐳 <a href="docker_guide.qmd">Docker Setup</a></li>
<li>🧪 <a href="Conda.qmd">Conda Environment</a></li>
</ul>
</section>
<section id="notes" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="notes"><span class="header-section-number">4.7</span> 📝 Notes</h2>
<p>If you encounter permission errors or missing dependencies, refer to <a href="troubleshooting.qmd">Troubleshooting</a>.</p>
<pre><code>

Let me know if you want to include a section for installing a local Conda environment (`environment.yml`) or a helper `install.sh`.</code></pre>
</section>
</section>
<section id="reference-setup" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> reference setup</h1>
<p>title: “🧬 Initial documents and reference setups” ## 🔧 Utilities</p>
<p>The following helper scripts are available in the <code>modules/utils/</code> directory for setup and validation:</p>
<section id="setup_reference.sh" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="setup_reference.sh"><span class="header-section-number">5.0.1</span> 🧬 <code>setup_reference.sh</code></h3>
<p>Automates the preparation of <strong>genome reference</strong> directories and indexes.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> modules/utils/setup_reference.sh <span class="op">&lt;</span>GENOME_NAME<span class="op">&gt;</span> <span class="op">&lt;</span>GENOME_FASTA<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> modules/utils/setup_reference.sh hg38 /path/to/hg38.fa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>What it does:</strong></p>
<ul>
<li><p>Creates a genome folder under <code>resources/genomes/GENOME_NAME/</code></p></li>
<li><p>Generates:</p>
<ul>
<li><code>.fai</code> index via <code>samtools faidx</code></li>
<li><code>bwa</code> index (<code>bwa index</code>)</li>
<li>Chromosome sizes (<code>.chrom.sizes</code>)</li>
<li>Dictionary via <code>picard CreateSequenceDictionary</code></li>
</ul></li>
</ul>
</section>
<section id="setup_spikein_refs.sh" class="level3" data-number="5.0.2">
<h3 data-number="5.0.2" class="anchored" data-anchor-id="setup_spikein_refs.sh"><span class="header-section-number">5.0.2</span> 🐝 <code>setup_spikein_refs.sh</code></h3>
<p>Prepares <strong>spike-in reference genomes</strong> similarly to the main genome.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> modules/utils/setup_spikein_refs.sh <span class="op">&lt;</span>SPIKE_NAME<span class="op">&gt;</span> <span class="op">&lt;</span>SPIKE_FASTA<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> modules/utils/setup_spikein_refs.sh dm6 /path/to/dm6.fa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Creates:</strong></p>
<ul>
<li>Indexed <code>bwa</code> genome and dictionary for the spike</li>
<li>Organized under <code>resources/spikein/SPIKE_NAME/</code></li>
</ul>
<p>These scripts <strong>must be run before alignment steps</strong> in the pipeline to ensure all genome/spike references are available and indexed properly.</p>
<p>Let me know if you’d like a Makefile target to wrap these commands for common genomes (e.g., hg38 + dm6).</p>
</section>
</section>
<section id="pipeline1" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> pipeline1</h1>
<p>title: “🔄 Pipeline 1: QC &amp; Preprocessing Modules”</p>
<section id="pipeline-1-qc-preprocessing-modules" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="pipeline-1-qc-preprocessing-modules"><span class="header-section-number">6.1</span> 🔄 Pipeline 1: QC &amp; Preprocessing Modules</h2>
</section>
<section id="supported-data-types" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="supported-data-types"><span class="header-section-number">6.2</span> 🧬 Supported Data Types</h2>
<p>This pipeline is designed for <strong>ChIP-seq</strong> and <strong>ATAC-seq</strong> data preprocessing. It includes:</p>
<ul>
<li>Adapter trimming (<code>cutadapt</code>)</li>
<li>Parallel quality control (<code>FastQC</code>)</li>
<li>Optional spike-in filtering</li>
<li>Mitochondrial read removal</li>
<li>Blacklist region filtering (ENCODE)</li>
<li>Clean alignment with BWA and BAM post-processing</li>
</ul>
<p>By supporting these steps, the pipeline ensures high-quality, reproducible inputs for downstream peak calling or chromatin accessibility analysis.</p>
<blockquote class="blockquote">
<p>🔁 While optimized for ChIP-seq, the pipeline is fully compatible with ATAC-seq experiments.</p>
</blockquote>
<p>Scripts: <code>01_init_directories.sh</code> to <code>11_Renaming_bam.sh</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">modules/pipeline1\$</span> tree . </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 01_init_directories.sh </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 02_reference_check.sh </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 03_input_fetch.sh </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 04_fastqc_parallel.sh </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 05_05_Cutadapt_trimming_phix_parallel.sh </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 06_fastqc_trimmed_parallel.sh </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 07_spike_detect.sh </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 08_alignment_bwa_spike.sh </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 09_readgroups_add.sh </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 10_bam_cleaning.sh </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> 10_plot_spike_qc_summary.R </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> 11_Renaming_bam.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Great structure! Given the flow of your Quarto document, the best place to add the <strong>usage documentation</strong> for <code>run_pipeline1.sh</code> would be <strong>after</strong> the <code>## 🧬 Supported Data Types</code> section and <strong>before</strong> the <code>### 🔧 Modules</code> section.</p>
<p>This keeps your document logically organized:</p>
<ol type="1">
<li><strong>Intro</strong></li>
<li><strong>What data it supports</strong></li>
<li><strong>How to run it (Usage) ✅</strong></li>
<li><strong>What each module does</strong></li>
<li><strong>What the outputs are</strong></li>
</ol>
<section id="suggested-update-add-this-block-in-your-.qmd-file" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="suggested-update-add-this-block-in-your-.qmd-file"><span class="header-section-number">6.2.1</span> ✅ Suggested Update (add this block in your <code>.qmd</code> file):</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🚀 Usage: `run_pipeline1.sh`</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>This script is the entry point for Pipeline 1 and supports both default and customized executions.</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ✅ Default Run</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>Run with all defaults:</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> run_pipeline1.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This uses:</p>
<ul>
<li><code>THREADS = 4</code></li>
<li><code>REFERENCE = hg38</code></li>
<li><code>ADAPTER = tn5_truseq</code></li>
<li><code>PLATFORM = ILLUMINA</code></li>
<li><code>MAPPING = metadata/mapping.tsv</code></li>
<li><code>REPORT_FORMAT = human</code></li>
</ul>
<section id="full-custom-run" class="level4" data-number="6.2.1.1">
<h4 data-number="6.2.1.1" class="anchored" data-anchor-id="full-custom-run"><span class="header-section-number">6.2.1.1</span> 🔧 Full Custom Run</h4>
<p>Example of overriding all defaults:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> run_pipeline1.sh <span class="at">-t</span> 8 <span class="at">-r</span> mm10 <span class="at">-a</span> tn5_nextera <span class="at">-p</span> IONTORRENT <span class="at">-m</span> data/sample_metadata.tsv <span class="at">-f</span> csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Overrides:</p>
<ul>
<li><code>-t 8</code>: 8 threads</li>
<li><code>-r mm10</code>: mouse genome</li>
<li><code>-a tn5_nextera</code>: alternative adapter</li>
<li><code>-p IONTORRENT</code>: sequencing platform</li>
<li><code>-m data/sample_metadata.tsv</code>: custom mapping file</li>
<li><code>-f csv</code>: report format</li>
</ul>
</section>
<section id="ℹ-help" class="level4" data-number="6.2.1.2">
<h4 data-number="6.2.1.2" class="anchored" data-anchor-id="ℹ-help"><span class="header-section-number">6.2.1.2</span> ℹ️ Help</h4>
<p>For option details:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> run_pipeline1.sh <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="modules" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="modules"><span class="header-section-number">6.2.2</span> 🔧 Modules</h3>
<table class="table table-striped table-hover caption-top" data-quarto-postprocess="true">
<caption><strong>🔧 Modules Overview</strong></caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Script</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01_init_directories.sh</td>
<td style="text-align: left;">Creates necessary directory structure.</td>
</tr>
<tr class="even">
<td style="text-align: left;">02_reference_check.sh</td>
<td style="text-align: left;">Validates presence of genome reference files.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03_input_fetch.sh</td>
<td style="text-align: left;">Fetches and decompresses user-supplied FASTQ files.</td>
</tr>
<tr class="even">
<td style="text-align: left;">04_fastqc_parallel.sh</td>
<td style="text-align: left;">Runs FastQC and generates quality reports.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05_Cutadapt_trimming_phix_parallel.sh</td>
<td style="text-align: left;">Trims adapters and low-quality bases using Cutadapt.</td>
</tr>
<tr class="even">
<td style="text-align: left;">06_fastqc_trimmed_parallel.sh</td>
<td style="text-align: left;">Runs FastQC on trimmed reads.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">07_spike_detect.sh</td>
<td style="text-align: left;">Detects exogenous spike-in if not provided.</td>
</tr>
<tr class="even">
<td style="text-align: left;">08_alignment_bwa_spike.sh</td>
<td style="text-align: left;">Aligns reads using BWA and checks spike content.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">09_readgroups_add.sh</td>
<td style="text-align: left;">Adds read group metadata using Picard.</td>
</tr>
<tr class="even">
<td style="text-align: left;">10_bam_cleaning.sh</td>
<td style="text-align: left;">Cleans and indexes BAMs; performs spike-in QC.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11_Renaming_bam.sh</td>
<td style="text-align: left;">Renames BAMs using mapping.tsv for grouping.</td>
</tr>
</tbody>
</table>
</section>
<section id="output-folders" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="output-folders"><span class="header-section-number">6.2.3</span> 📁 Output Folders</h3>
<p>results/: Raw outputs and intermediate files.</p>
<p>analysis/Renamed_Cleaned: Cleaned and filtered BAMs for downstream usage.</p>
<p>results/</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">results/Filtered$</span> tree </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> BAM}</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> Filtered</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├</span>        ├── Cleaned  ✅ here are the cleaned BAM that will be renamed. │</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├</span>        ├── Deduplicated</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├</span>        └── Metrics</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> QC_fastqc</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> QC_spike_plots</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> QC_trimmed_fastqc</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> spike_analysis</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> Trimmed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="pipeline2" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> pipeline2</h1>
<p>title: “🔄 Pipeline 2: Peak Calling, Reproducibility, and Functional Annotation”</p>
<p>Pipeline2 continues the analysis after preprocessing and alignment, performing replicate QC, peak calling, and reproducibility evaluation via IDR. It supports both MACS3 and HOMER peak callers, with outputs from both individual and pooled replicates.</p>
<p>During the IDR evaluation, a series of QC analyses is performed, and an HTML/PDF report is generated and stored at:</p>
<pre><code>
analysis/IDR\_Results/homer/IDR\_qc\_summary/
</code></pre>
<p>The report includes and are in HTML and pdf format:</p>
<ul>
<li>🧬 Spike-In Detection Summary<br>
</li>
<li>📊 Replicate QC Plots &amp; 🖋️ Fingerprint Curves (Pre-IDR)<br>
</li>
<li>🧬 PCR Bottleneck Coefficient (PBC)<br>
</li>
<li>📈 IDR Evaluation Plots<br>
</li>
<li>📊 FRiP Scores from Initial Peak Calling<br>
</li>
<li>🔹 High-confidence Peak Metrics<br>
</li>
<li>🔹 Replicate Agreement (Rescue &amp; Self-Consistency)<br>
</li>
<li>🔹 Jaccard Overlap (Replicate Peak Similarity)</li>
</ul>
<section id="example-reports" class="level3" data-number="7.0.1">
<h3 data-number="7.0.1" class="anchored" data-anchor-id="example-reports"><span class="header-section-number">7.0.1</span> 📎 Example Reports</h3>
<p>👉 <strong>hg38</strong>: <a href="files/hg38_idr_report.pdf">📎 View report (PDF)</a><br>
👉 <strong>mm10</strong>: <a href="files/mm10_idr_report.pdf">📎 View report (PDF)</a></p>
<p>In addition to nearest-gene TSS annotation using HOMER, the pipeline performs <strong>functional enrichment analysis entirely locally</strong> — without relying on online services. Enrichment is based on:</p>
<ul>
<li>Gene Ontology (GO): Biological Process (BP), Cellular Component (CC), Molecular Function (MF)</li>
<li>Gene Ontology (GO): BP, CC, MF<br>
</li>
<li>KEGG pathways<br>
</li>
<li>Reactome pathways<br>
</li>
<li>g:Profiler (via the local <code>gprofiler2</code> R package)<br>
</li>
<li><code>clusterProfiler</code> and <code>org.*.eg.db</code> annotation databases for human and mouse</li>
</ul>
<p>The final summary file <code>PRE_POSSIBLE_OUTCOME.tsv</code> integrates gene annotations across conditions, identifying <strong>shared (intersection)</strong> and <strong>unique (condition-specific)</strong> signals.</p>
</section>
<section id="functional-enrichment-report" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="functional-enrichment-report"><span class="header-section-number">7.1</span> 🧬 Functional Enrichment Report</h2>
<p>The final enrichment summary report (including Gene Ontology, KEGG, Reactome, and g:Profiler figures) is available as a downloadable PDF and HTML. If the PRE_POSSIBLE_OUTCOME.tsv file is too large, the PDF will include only the g:Profiler figures. The full PRE_POSSIBLE_OUTCOME.tsv content will remain available in its original TSV format and within the HTML report.</p>
<section id="example-reports-1" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="example-reports-1"><span class="header-section-number">7.1.1</span> 📎 Example Reports</h3>
<p>👉 <strong>hg38</strong>: <a href="files/hg38_Functional_Enrichment_Report_plots_only.pdf">📎 View report (PDF)</a><br>
👉 <strong>mm10</strong>: <a href="files/mm10_Functional_Enrichment_Report.pdf">📎 View report (PDF)</a></p>
</section>
<section id="usage-run_pipeline2.sh" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="usage-run_pipeline2.sh"><span class="header-section-number">7.1.2</span> 🚀 Usage: <code>run_pipeline2.sh</code></h3>
<p>This script runs <strong>Pipeline 2</strong> — performing peak calling, replicate QC, IDR analysis, and functional annotation using MACS3 and HOMER.</p>
<section id="default-run" class="level4" data-number="7.1.2.1">
<h4 data-number="7.1.2.1" class="anchored" data-anchor-id="default-run"><span class="header-section-number">7.1.2.1</span> ✅ Default Run</h4>
<p>Run with all default parameters:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> run_pipeline2.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will use:</p>
<ul>
<li><code>REFERENCE = hg38</code></li>
<li><code>MAPPING = metadata/mapping.tsv</code></li>
<li><code>PEAK_CALLER = both</code> (MACS3 and HOMER)</li>
<li><code>THREADS = 4</code></li>
<li><code>IDR_THRESHOLD = 0.05</code></li>
<li><code>TARGET_RULES = templates/target_peak_rules.yaml</code></li>
<li><code>TSS_DB = HOMER</code> (for annotation)</li>
</ul>
<blockquote class="blockquote">
<p>✅ Defaults are suitable for most <strong>ChIP-seq</strong> and <strong>ATAC-seq</strong> use cases.</p>
</blockquote>
</section>
<section id="full-custom-run-1" class="level4" data-number="7.1.2.2">
<h4 data-number="7.1.2.2" class="anchored" data-anchor-id="full-custom-run-1"><span class="header-section-number">7.1.2.2</span> 🔧 Full Custom Run</h4>
<p>Customize all parameters:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> run_pipeline2.sh <span class="dt">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-r</span> mm10 <span class="dt">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-m</span> data/sample_metadata.tsv <span class="dt">\</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-p</span> macs3 <span class="dt">\</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-t</span> 8 <span class="dt">\</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-i</span> 0.01 <span class="dt">\</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-y</span> templates/target_peak_rules_HOMER.yaml <span class="dt">\</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">--tss-db</span> clusterProfiler</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Explanation:</p>
<ul>
<li><code>-r mm10</code> → Use mouse genome</li>
<li><code>-m data/sample_metadata.tsv</code> → Custom metadata file</li>
<li><code>-p macs3</code> → Use MACS3 only (can be <code>macs3</code>, <code>homer</code>, or <code>both</code>)</li>
<li><code>-t 8</code> → Use 8 threads</li>
<li><code>-i 0.01</code> → Adjust IDR threshold</li>
<li><code>-y templates/target_peak_rules_HOMER.yaml</code> → Custom target rules</li>
<li><code>--tss-db clusterProfiler</code> → Use <code>clusterProfiler</code> instead of HOMER for gene annotation.</li>
</ul>
</section>
<section id="ℹ-help-1" class="level4" data-number="7.1.2.3">
<h4 data-number="7.1.2.3" class="anchored" data-anchor-id="ℹ-help-1"><span class="header-section-number">7.1.2.3</span> ℹ️ Help</h4>
<p>To see all options:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> run_pipeline2.sh <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="mapping_schema.yaml-metadata-validation-rules" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="mapping_schema.yaml-metadata-validation-rules"><span class="header-section-number">7.1.3</span> 📄 1. <code>mapping_schema.yaml</code> — Metadata Validation Rules</h3>
<p>Defines structure and validation logic for your <code>mapping.tsv</code> metadata.</p>
<section id="key-elements" class="level4" data-number="7.1.3.1">
<h4 data-number="7.1.3.1" class="anchored" data-anchor-id="key-elements"><span class="header-section-number">7.1.3.1</span> 🔍 Key Elements:</h4>
<ul>
<li><strong>Required fields</strong>: <code>Sample_ID</code>, <code>Instrument</code>, <code>Sample_Type</code>, <code>Condition</code>, <code>Replicate</code>, <code>Target</code></li>
<li><strong>Optional fields</strong>: <code>Cell_line</code>, <code>Spike_Type</code></li>
<li><strong>Regex validation</strong>: For fields like <code>Sample_Type</code>, <code>Replicate</code></li>
</ul>
</section>
<section id="validate-schema-file" class="level4" data-number="7.1.3.2">
<h4 data-number="7.1.3.2" class="anchored" data-anchor-id="validate-schema-file"><span class="header-section-number">7.1.3.2</span> ✅ Validate Schema File</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> modules/utils/validate_mapping_yaml.sh templates/mapping_schema.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="validate-metadata-file" class="level4" data-number="7.1.3.3">
<h4 data-number="7.1.3.3" class="anchored" data-anchor-id="validate-metadata-file"><span class="header-section-number">7.1.3.3</span> ✅ Validate Metadata File</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> modules/utils/validate_mapping.py <span class="dt">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--mapping</span> metadata/mapping.tsv <span class="dt">\</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--schema</span> templates/mapping_schema.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="target_peak_rules.yaml-peak-calling-styles-macs3" class="level3" data-number="7.1.4">
<h3 data-number="7.1.4" class="anchored" data-anchor-id="target_peak_rules.yaml-peak-calling-styles-macs3"><span class="header-section-number">7.1.4</span> 📄 2. <code>target_peak_rules.yaml</code> — Peak Calling Styles (MACS3)</h3>
<p>This config determines which targets require <strong>narrow</strong> or <strong>broad</strong> peak calling.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><code>CTCF</code>, <code>MYC</code> → <code>narrowPeak</code></li>
<li><code>H3K27me3</code>, <code>EZH2</code> → <code>broadPeak</code></li>
</ul>
</section>
<section id="target_peak_rules_homer.yaml-peak-calling-styles-homer" class="level3" data-number="7.1.5">
<h3 data-number="7.1.5" class="anchored" data-anchor-id="target_peak_rules_homer.yaml-peak-calling-styles-homer"><span class="header-section-number">7.1.5</span> 📄 3. <code>target_peak_rules_HOMER.yaml</code> — Peak Calling Styles (HOMER)</h3>
<p>Classifies targets by <strong>style</strong> for <code>findPeaks</code>:</p>
<ul>
<li><code>factor</code> → e.g., <code>MYC</code>, <code>SOX2</code></li>
<li><code>histone</code> → e.g., <code>H3K27me3</code>, <code>EZH2</code></li>
<li><code>GROseq</code>, <code>DNaseI</code>, etc.</li>
</ul>
<blockquote class="blockquote">
<p>⚠️ Note: These files are pre-validated. If you add new targets, you must write your own validation.</p>
</blockquote>
</section>
</section>
<section id="modules-01_replicate_qc.sh-to-06_igv_snapshot.sh" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="modules-01_replicate_qc.sh-to-06_igv_snapshot.sh"><span class="header-section-number">7.2</span> 📊 Modules: <code>01_replicate_qc.sh</code> to <code>06_igv_snapshot.sh</code></h2>
<pre><code>modules/pipeline2/
├── 01_replicate_qc.sh
├── 02_merge_pseudoreplicates.sh
├── 03_1_MACS3_peak_calling.sh
├── 03_2_homer_peak_calling_fold_fdr_relaxed.sh
├── 03_2_homer_to_peakFormat.R
├── 03_3_MACS3_peak_calling_pooled_pseudoreps.sh
├── 03_4_homer_peak_calling_pooled_pseudoreps.sh
├── 04_plot_idr_summary.R
├── 04_run_idr.sh
├── 05_peak_annotation.sh
├── 06_igv_snapshot.sh
└── cluster_enrichment_updated_hg_mice.R</code></pre>
<section id="modules-1" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="modules-1"><span class="header-section-number">7.2.1</span> 🔧 Modules</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>Script</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>01_replicate_qc.sh</code></td>
<td>Analyzes biological replicates for correlation (cutoff: 0.8), filters low-correlation samples.</td>
</tr>
<tr class="even">
<td><code>02_merge_pseudoreplicates.sh</code></td>
<td>Merges BAMs and creates pseudo-replicates for IDR.</td>
</tr>
<tr class="odd">
<td><code>03_1_MACS3_peak_calling.sh</code></td>
<td>Peak calling using MACS3 with smart baseline control matching.</td>
</tr>
<tr class="even">
<td><code>03_2_homer_peak_calling_fold_fdr_relaxed.sh</code></td>
<td>HOMER-based peak calling using <code>target_peak_rules_HOMER.yaml</code>.</td>
</tr>
<tr class="odd">
<td><code>03_3_MACS3_peak_calling_pooled_pseudoreps.sh</code></td>
<td>MACS3 peak calling for pooled/pseudo BAMs.</td>
</tr>
<tr class="even">
<td><code>03_4_homer_peak_calling_pooled_pseudoreps.sh</code></td>
<td>HOMER peak calling for pooled/pseudo BAMs.</td>
</tr>
<tr class="odd">
<td><code>04_run_idr.sh</code></td>
<td>Runs IDR on replicate pairs, pooled vs individual, etc.</td>
</tr>
<tr class="even">
<td><code>05_peak_annotation.sh</code></td>
<td>Performs TSS annotation of peak files.</td>
</tr>
<tr class="odd">
<td><code>06_igv_snapshot.sh</code></td>
<td>Generates IGV snapshots for peak visualization.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p>⚠️ Note :06_igv_snapshot.sh is an extra module not yet adapted to the pipeline. This particular script produce to many snapshots if the user do not define the peaks based on their needs. ————————————————————————</p>
</blockquote>
</section>
</section>
<section id="analysis-folder-structure" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="analysis-folder-structure"><span class="header-section-number">7.3</span> 🗂 Analysis Folder Structure</h2>
<pre><code>analysis$ tree -L 1
.
├── BAM_replicate_fail
├── ChIPseeker_TSS_Hommer_IDR_annotation
├── IDR_Results
│   ├── homer
│   └── macs3
├── PeakCalling_HOMER
├── PeakCalling_HOMER_pool_pseudo
├── PeakCalling_MACS3
├── PeakCalling_MACS3_pool_pseudo
├── Pooled_BAMs
├── pooling_log.tsv
├── Pool_Pseudo_QC_stats
├── Pseudoreplicates
├── Renamed_Cleaned
└── Replicate_QC
    ├── bigwig
    ├── deeptools
    ├── pbc_metrics.tsv
    └── tmp_groups</code></pre>
</section>
</section>
<section id="mapping" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> mapping</h1>
<p>title: “Preprocessing Modules”</p>
<section id="creating-the-mapping.tsv-file-metadata-table" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="creating-the-mapping.tsv-file-metadata-table"><span class="header-section-number">8.1</span> 🗺️ Creating the <code>mapping.tsv</code> File (Metadata Table)</h2>
<p>The metadata file is crucial for automating sample grouping, identifying replicates, and selecting the appropriate peak caller.</p>
<blockquote class="blockquote">
<p>🧠 <strong>Filename required:</strong> <code>metadata/mapping.tsv</code></p>
</blockquote>
<section id="required-columns" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="required-columns"><span class="header-section-number">8.1.1</span> ✅ Required Columns</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 51%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Sample_ID</code></td>
<td>Unique ID matching FASTQ or BAM files</td>
<td><code>SRR123456</code></td>
</tr>
<tr class="even">
<td><code>Instrument</code></td>
<td>Sequencing instrument or platform</td>
<td><code>Illumina</code></td>
</tr>
<tr class="odd">
<td><code>Sample_Type</code></td>
<td><code>ChIP</code>, <code>Input</code>, <code>IgG</code>, <code>Mock</code>, etc.</td>
<td><code>ChIP</code></td>
</tr>
<tr class="even">
<td><code>Condition</code></td>
<td>Experimental condition or group</td>
<td><code>Treated</code>, <code>WT</code></td>
</tr>
<tr class="odd">
<td><code>Replicate</code></td>
<td>Replicate number (<code>1</code>, <code>2</code>, <code>3</code>, …)</td>
<td><code>1</code></td>
</tr>
<tr class="even">
<td><code>Target</code></td>
<td>Transcription factor or histone mark</td>
<td><code>H3K27ac</code>, <code>CTCF</code></td>
</tr>
</tbody>
</table>
</section>
<section id="optional-columns" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="optional-columns"><span class="header-section-number">8.1.2</span> 📝 Optional Columns</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Cell_line</code></td>
<td>Cell line used</td>
<td><code>HEK293</code></td>
</tr>
<tr class="even">
<td><code>Spike_Type</code></td>
<td>If spike-in is used (e.g., <code>dm6</code>, <code>ERCC</code>)</td>
<td><code>dm6</code></td>
</tr>
</tbody>
</table>
</section>
<section id="example-structure" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="example-structure"><span class="header-section-number">8.1.3</span> 📁 Example Structure</h3>
<pre class="tsv"><code>Sample_ID   Instrument  Sample_Type Condition   Replicate   Target  Cell_line   Spike_Type
SRR001      Illumina    ChIP        WT          1         CTCF       HEK293     dm6
SRR002      Illumina    ChIP        WT          2         CTCF       HEK293     dm6
SRR003      Illumina    Input       WT          1         None       HEK293     dm6
SRR004      Illumina    ChIP        KO          1         H3K27me3   HEK293     dm6
SRR005      Illumina    ChIP        KO          2         H3K27me3   HEK293     dm6
SRR006      Illumina    Input       KO          1         None       HEK293     dm6</code></pre>
</section>
<section id="validation-steps" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="validation-steps"><span class="header-section-number">8.1.4</span> 🧪 Validation Steps</h3>
<p>Make sure your file is valid before starting the pipeline:</p>
<ol type="1">
<li><strong>Validate schema:</strong></li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> modules/utils/validate_mapping_yaml.sh templates/mapping_schema.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><strong>Validate metadata:</strong></li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> modules/utils/validate_mapping.py <span class="dt">\</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--mapping</span> metadata/mapping.tsv <span class="dt">\</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--schema</span> templates/mapping_schema.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>✔️ You should see “Validation Passed” if everything is correct.</p>
</section>
</section>
<section id="what-is-mapping.tsv-and-why-is-it-important" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="what-is-mapping.tsv-and-why-is-it-important"><span class="header-section-number">8.2</span> 📋 What is <code>mapping.tsv</code> and Why Is It Important?</h2>
<section id="what-is-it" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="what-is-it"><span class="header-section-number">8.2.1</span> 🔍 What is it?</h3>
<p>The <code>mapping.tsv</code> is a <strong>metadata table</strong>—a plain text file in tab-separated format—that contains structured information about each sample in your ChIP-seq experiment. Each row represents a sequencing sample, and each column provides key attributes (e.g., sample ID, condition, replicate number, target protein, etc.).</p>
<p>This file needs to be stored at:</p>
<pre><code>metadata/mapping.tsv</code></pre>
<p>This mapping table will be transformed during the pipeline process: at then you will have a backup (mapping.tsv.bak), mapping_filtered.tsv (produce after replicates QC), and mapping_scaled.tsv (produced after bam cleaning, it contains the ratio of exogenous spike , if spike was detected, and the spike genome type).</p>
</section>
<section id="why-is-it-needed" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="why-is-it-needed"><span class="header-section-number">8.2.2</span> 🧠 Why is it needed?</h3>
<p>This file is <strong>critical</strong> for enabling your pipeline to:</p>
<p>✅ <strong>Recognize and organize samples</strong> automatically ✅ <strong>Group replicates</strong> (for IDR and reproducibility checks) ✅ <strong>Assign controls</strong> (Input, IgG, Mock) correctly for peak calling ✅ <strong>Select peak caller styles</strong> (e.g., narrowPeak for TFs, broadPeak for histone marks) ✅ <strong>Validate input consistency</strong> using the YAML schema</p>
<p>Without this file, the pipeline wouldn’t know how your samples relate to each other—or how to process them correctly.</p>
</section>
<section id="how-does-the-pipeline-use-it" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="how-does-the-pipeline-use-it"><span class="header-section-number">8.2.3</span> 🔗 How does the pipeline use it?</h3>
<ul>
<li><p><strong>Pipeline 1:</strong> The script <code>11_Renaming_bam.sh</code> uses the metadata to automatically rename BAM files and organize them into logical groups.</p></li>
<li><p><strong>Pipeline 2:</strong> Several scripts (e.g., <code>01_replicate_qc.sh</code>, <code>03_1_MACS3_peak_calling.sh</code>) read <code>mapping.tsv</code> to apply the right rules for:</p>
<ul>
<li>Sample pairing (ChIP vs.&nbsp;Input)</li>
<li>Replicate merging</li>
<li>Peak calling type</li>
<li>Reproducibility evaluation (IDR)</li>
</ul></li>
<li><p><strong>Validation scripts</strong> (<code>validate_mapping.py</code>, <code>validate_mapping_yaml.sh</code>) ensure the file is complete and follows strict format rules before any analysis starts.</p></li>
</ul>
</section>
<section id="summary" class="level3" data-number="8.2.4">
<h3 data-number="8.2.4" class="anchored" data-anchor-id="summary"><span class="header-section-number">8.2.4</span> 🧬 Summary</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Why it matters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Automation</strong></td>
<td>Removes manual handling of sample groups</td>
</tr>
<tr class="even">
<td><strong>Reproducibility</strong></td>
<td>Ensures the same logic applies every time</td>
</tr>
<tr class="odd">
<td><strong>Compatibility</strong></td>
<td>Lets the pipeline work across diverse experimental designs</td>
</tr>
<tr class="even">
<td><strong>Quality control</strong></td>
<td>Prevents broken analyses due to misannotated samples</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="docker-pipeline1" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> docker pipeline1</h1>
<p>title: “🐳 Running Pipeline1 with Docker”</p>
<section id="running-pipeline1-with-docker" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="running-pipeline1-with-docker"><span class="header-section-number">9.1</span> 🏃 Running Pipeline1 with Docker</h2>
<p>🐳 Docker Usage Guide</p>
<p>This guide explains <strong>how to build and run</strong> the ChIP-seq processing pipeline using Docker. It is designed for users at all levels, including beginners.</p>
<p>While the original pipeline was created to work directly in Host-based installation, the pipeline can be used with docker containers and mounting the required folder needed for the package This pipeline is fully containerized and can be run with a single Docker command. Below is the recommended usage to <strong>preserve outputs</strong>, access your own data, and avoid re-downloading references.</p>
<section id="docker-requirements" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="docker-requirements"><span class="header-section-number">9.1.1</span> 🔧 Docker Requirements</h3>
<ul>
<li><p>Docker installed and working (<code>docker --version</code>)</p></li>
<li><p>Your working directory should contain:</p>
<ul>
<li><code>Reference/</code> — genome files (e.g.&nbsp;<code>hg38</code>, <code>mm10</code>, etc.)</li>
<li><code>metadata/</code> — sample sheet (<code>SRR_Acc_List.txt</code>, etc.)</li>
<li><code>samples/</code> — (optional) pre-existing FASTQs</li>
<li><code>results/</code> — (created if missing) final output goes here</li>
<li><code>logs/</code> — (created if missing) all logs go here</li>
</ul></li>
</ul>
</section>
<section id="run-command-example" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="run-command-example"><span class="header-section-number">9.1.2</span> 🧪 Run Command (Example)</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/Reference"</span>:/pipeline/Reference <span class="dt">\</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/SpikeinReference"</span>:/pipeline/SpikeinReference <span class="dt">\</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/metadata"</span>:/pipeline/metadata <span class="dt">\</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/samples"</span>:/pipeline/samples <span class="dt">\</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/results"</span>:/pipeline/results <span class="dt">\</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/logs"</span>:/pipeline/logs <span class="dt">\</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/logs"</span>:/pipeline/assets <span class="dt">\</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  pipeline1:latest <span class="at">-t</span> 4 <span class="at">-r</span> mm10 <span class="at">-a</span> tn5_truseq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="explanation" class="level3" data-number="9.1.3">
<h3 data-number="9.1.3" class="anchored" data-anchor-id="explanation"><span class="header-section-number">9.1.3</span> 📝 Explanation</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 67%">
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>--rm</code></td>
<td>Removes container after run</td>
</tr>
<tr class="even">
<td><code>-v &lt;host&gt;:&lt;container&gt;</code></td>
<td>Mounts folders into container</td>
</tr>
<tr class="odd">
<td><code>-t 4</code></td>
<td>Number of threads</td>
</tr>
<tr class="even">
<td><code>-r mm10</code></td>
<td>Reference genome (<code>hg38</code>, <code>mm10</code>, etc.)</td>
</tr>
<tr class="odd">
<td><code>-a tn5_truseq</code></td>
<td>Adapter type (should match what’s in your pipeline)</td>
</tr>
<tr class="even">
<td><code>pipeline1:latest</code></td>
<td>Docker image name</td>
</tr>
</tbody>
</table>
</section>
<section id="output" class="level3" data-number="9.1.4">
<h3 data-number="9.1.4" class="anchored" data-anchor-id="output"><span class="header-section-number">9.1.4</span> 📂 Output</h3>
<p>All outputs go into your local <code>results/</code> and <code>logs/</code> folders — no data is lost after the container exits.</p>
</section>
</section>
</section>
<section id="docker-pipeline2" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> docker pipeline2</h1>
<p>title: “🐳 Running Pipeline2 with Docker”</p>
<section id="build-the-docker-image" class="level3" data-number="10.0.1">
<h3 data-number="10.0.1" class="anchored" data-anchor-id="build-the-docker-image"><span class="header-section-number">10.0.1</span> 👷‍️⛏️ 1. Build the Docker Image</h3>
<p>From the folder containing <code>Dockerfile.pipeline2</code>, run:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-f</span> Dockerfile.pipeline2 <span class="at">-t</span> pipeline2-image .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>-f</code>: specifies the Dockerfile to use.</li>
<li><code>-t</code>: tags the image name as <code>pipeline2-image</code>.</li>
<li><code>.</code>: tells Docker to build using the current directory context.</li>
</ul>
</section>
<section id="project-structure" class="level3" data-number="10.0.2">
<h3 data-number="10.0.2" class="anchored" data-anchor-id="project-structure"><span class="header-section-number">10.0.2</span> 📁 2. Project Structure</h3>
<p>A typical folder layout:</p>
<pre><code>your_project/
├── run_pipeline2.sh
├── modules/
│   └── pipeline2/
├── metadata/
├── Reference/
├── templates/
├── logs/
├── analysis/           # Will be populated by the pipeline</code></pre>
<p>Ensure all these folders exist, especially <code>Reference/</code>, <code>metadata/</code>, and <code>modules/</code>.</p>
</section>
<section id="mounting-folders" class="level3" data-number="10.0.3">
<h3 data-number="10.0.3" class="anchored" data-anchor-id="mounting-folders"><span class="header-section-number">10.0.3</span> 🗃️ 3. Mounting Folders</h3>
<p>To give Docker access to your files, bind-mount these folders:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 57%">
<col style="width: 16%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Host Path</th>
<th>Docker Path</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>$PWD</code></td>
<td><code>/pipeline2</code></td>
<td>Root of your pipeline package</td>
</tr>
<tr class="even">
<td><code>$PWD/Reference</code></td>
<td><code>/pipeline2/Reference</code></td>
<td>Genome files (FASTA, GTF, BED)</td>
</tr>
<tr class="odd">
<td><code>$PWD/metadata</code></td>
<td><code>/pipeline2/metadata</code></td>
<td>Sample metadata for input</td>
</tr>
<tr class="even">
<td><code>$PWD/templates</code></td>
<td><code>/pipeline2/templates</code></td>
<td>Mapping schema, rules</td>
</tr>
<tr class="odd">
<td><code>$PWD/logs</code></td>
<td><code>/pipeline2/logs</code></td>
<td>Store logs</td>
</tr>
<tr class="even">
<td><code>$PWD/analysis</code></td>
<td><code>/pipeline2/analysis</code></td>
<td>All analysis results are saved here</td>
</tr>
<tr class="odd">
<td><code>$PWD/assets</code></td>
<td><code>/pipeline2/assets</code></td>
<td>Contains images icon for the IDR</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>report. Can be changed by user</td>
</tr>
<tr class="odd">
<td><hr></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="run-the-pipeline" class="level3" data-number="10.0.4">
<h3 data-number="10.0.4" class="anchored" data-anchor-id="run-the-pipeline"><span class="header-section-number">10.0.4</span> 🏃 4. Run the Pipeline</h3>
<p>Example command:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">:/pipeline2"</span> <span class="dt">\</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/Reference:/pipeline2/Reference"</span> <span class="dt">\</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/metadata:/pipeline2/metadata"</span> <span class="dt">\</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/templates:/pipeline2/templates"</span> <span class="dt">\</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/logs:/pipeline2/logs"</span> <span class="dt">\</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/analysis:/pipeline2/analysis"</span> <span class="dt">\</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /pipeline2 <span class="dt">\</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  pipeline2-image <span class="dt">\</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  bash run_pipeline2.sh <span class="at">--caller</span> macs3 <span class="at">-genome</span> mm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="output-files" class="level3" data-number="10.0.5">
<h3 data-number="10.0.5" class="anchored" data-anchor-id="output-files"><span class="header-section-number">10.0.5</span> 📦 5. Output Files</h3>
<p>After running, the results will be in:</p>
<ul>
<li><code>analysis/</code> — contains pipeline outputs and QC summaries</li>
<li><code>logs/</code> — contains module-specific logs</li>
<li><code>metadata/mapping_filtered_IDR.tsv</code> — filtered metadata after validation</li>
</ul>
</section>
<section id="optional-helper-shell-script" class="level3" data-number="10.0.6">
<h3 data-number="10.0.6" class="anchored" data-anchor-id="optional-helper-shell-script"><span class="header-section-number">10.0.6</span> 🛠️️️ 6. Optional: Helper Shell Script</h3>
<p>Create a script like <code>run.sh</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">:/pipeline2"</span> <span class="dt">\</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/Reference:/pipeline2/Reference"</span> <span class="dt">\</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/metadata:/pipeline2/metadata"</span> <span class="dt">\</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/templates:/pipeline2/templates"</span> <span class="dt">\</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/logs:/pipeline2/logs"</span> <span class="dt">\</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">/analysis:/pipeline2/analysis"</span> <span class="dt">\</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">-w</span> /pipeline2 <span class="dt">\</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  pipeline2-image <span class="dt">\</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  bash run_pipeline2.sh <span class="st">"</span><span class="va">$@</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then run it like this:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x run.sh</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./run.sh</span> <span class="at">--caller</span> homer <span class="at">-genome</span> mm10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="docker-guide" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> docker guide</h1>
<p>title: ” 🐳 Docker guide”</p>
<p>Docker provides a reproducible, isolated environment for running the pipeline. Once the image is built, the entire analysis can be executed without requiring local software installations.</p>
<section id="running-the-pipeline-in-docker" class="level3" data-number="11.0.1">
<h3 data-number="11.0.1" class="anchored" data-anchor-id="running-the-pipeline-in-docker"><span class="header-section-number">11.0.1</span> ⚙️ Running the Pipeline in Docker</h3>
<p>Use the following command to launch the container:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-v</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">:/pipeline2"</span> <span class="at">-w</span> /pipeline2 pipeline2-image <span class="dt">\</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  bash run_pipeline2.sh <span class="pp">[</span><span class="ss">options</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command:</p>
<ul>
<li>Mounts your current directory (<code>$PWD</code>) into the container at <code>/pipeline2</code></li>
<li>Sets <code>/pipeline2</code> as the working directory</li>
<li>Executes the pipeline script inside the container</li>
</ul>
</section>
<section id="project-structure-inside-the-container" class="level3" data-number="11.0.2">
<h3 data-number="11.0.2" class="anchored" data-anchor-id="project-structure-inside-the-container"><span class="header-section-number">11.0.2</span> 📁 Project Structure Inside the Container</h3>
<p>Your pipeline files are accessible under:</p>
<pre><code>/pipeline2/
├── run_pipeline2.sh
├── modules/pipeline2/
├── metadata/
├── Reference/
├── logs/
├── analysis/</code></pre>
<p>Relative paths like <code>modules/pipeline2/04_run_idr.sh</code> will resolve correctly.</p>
</section>
<section id="docker-command-summary" class="level3" data-number="11.0.3">
<h3 data-number="11.0.3" class="anchored" data-anchor-id="docker-command-summary"><span class="header-section-number">11.0.3</span> 🔗 Docker Command Summary</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Build image</strong></td>
<td><code>docker build -f Dockerfile.pipeline2 -t pipeline2-image .</code></td>
</tr>
<tr class="even">
<td><strong>Run pipeline</strong></td>
<td><code>docker run -v "$PWD:/pipeline2" -w /pipeline2 pipeline2-image ...</code></td>
</tr>
<tr class="odd">
<td><strong>View results</strong></td>
<td>Check output files in your local <code>analysis/</code> and <code>logs/</code> directories</td>
</tr>
</tbody>
</table>
<p>For advanced options or troubleshooting, refer to the main documentation or contact the maintainers.</p>
</section>
</section>
<section id="conda" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Conda</h1>
<p>title: “🐍 Core enviroment:conda”</p>
<section id="env_pipeline_base.yml-core-environment" class="level3" data-number="12.0.1">
<h3 data-number="12.0.1" class="anchored" data-anchor-id="env_pipeline_base.yml-core-environment"><span class="header-section-number">12.0.1</span> ✅ 1. <code>env_pipeline_base.yml</code> — Core environment</h3>
<p>Below are two separate <strong>Conda environment YAML files</strong>:</p>
<p>This includes all necessary packages for running the pipeline in a non-Docker setup, excluding R packages and HOMER.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> chipseq_pipeline_base</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> bioconda</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> defaults</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.9</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> numpy</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pyyaml</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> samtools&gt;=1.14</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> bedtools&gt;=2.30.0</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> bwa</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cutadapt&gt;=4.0</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> macs3</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> deeptools</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> jq</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-base=4.2</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-data.table</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-ggplot2</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-dplyr</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-readr</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-tidyr</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-stringr</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-jsonlite</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-httr</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> r-remotes</span><span class="co">  # for installing from GitHub</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">pip</span><span class="kw">:</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> idr</span><span class="co">  # we patch it manually later</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="env_pipeline_r.yml-optional-r-bioconductor-setup" class="level3" data-number="12.0.2">
<h3 data-number="12.0.2" class="anchored" data-anchor-id="env_pipeline_r.yml-optional-r-bioconductor-setup"><span class="header-section-number">12.0.2</span> ✅ 2. <code>env_pipeline_r.yml</code> — Optional: R + Bioconductor setup</h3>
<p>Use this to install additional R packages (run after activating <code>chipseq_pipeline_base</code>):</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In R</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="fu">c</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AnnotationDbi"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clusterProfiler"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"enrichplot"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ReactomePA"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"reactome.db"</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"biomaRt"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"org.Mm.eg.db"</span>,   <span class="co"># for mouse</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"org.Hs.eg.db"</span>    <span class="co"># for human</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="software-requirements-non-docker-setup" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="software-requirements-non-docker-setup"><span class="header-section-number">12.1</span> ⚙️ Software Requirements (Non-Docker Setup)</h2>
<p>While this pipeline is fully Docker-compatible, you can also run it natively by installing the required software through <strong>🐍 Conda</strong> and <strong>📘 ℝ</strong> .</p>
<section id="environment-files" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="environment-files"><span class="header-section-number">12.1.1</span> 📁 Environment Files</h3>
<p>All environment setup files are located in:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">env/</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> env_pipeline_base.yml     <span class="co"># Conda YAML file (base system + CLI tools)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> env_pipeline_r.R          <span class="co"># R script to install required R/Bioconductor packages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-1-create-conda-environment" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="step-1-create-conda-environment"><span class="header-section-number">12.1.2</span> 🧪 Step 1: Create Conda Environment</h3>
<p>Use the provided YAML file to create a clean Conda environment with all the command-line tools.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> env/env_pipeline_base.yml</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate chipseq_pipeline_base</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-install-r-and-bioconductor-packages" class="level3" data-number="12.1.3">
<h3 data-number="12.1.3" class="anchored" data-anchor-id="step-2-install-r-and-bioconductor-packages"><span class="header-section-number">12.1.3</span> 📦 Step 2: Install R and Bioconductor Packages</h3>
<p>Once inside the conda environment, install the required R packages using:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> env/env_pipeline_r.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This script will:</p>
<ul>
<li>Check for missing CRAN or Bioconductor dependencies</li>
<li>Install them as needed</li>
<li>Load the correct annotation packages for both human (hg38) and mouse (mm10) genomes</li>
</ul>
</section>
<section id="tool-dependencies" class="level3" data-number="12.1.4">
<h3 data-number="12.1.4" class="anchored" data-anchor-id="tool-dependencies"><span class="header-section-number">12.1.4</span> 🧰 Tool Dependencies</h3>
<p>Some tools like <code>picard.jar</code> and <code>qualimap</code> are <strong>not installed via Conda</strong> but are required. These are bundled inside the pipeline under:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tools/</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> picard.jar      <span class="co"># Required for BAM metadata tagging</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> qualimap/       <span class="co"># For BAM quality metrics (must be Java-compatible)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Make sure:</p>
<ul>
<li><code>tools/picard.jar</code> is accessible (used by <code>AddOrReplaceReadGroups</code>)</li>
<li><code>tools/qualimap/</code> is executable and on your <code>PATH</code> or referenced directly by the scripts</li>
</ul>
<p>Ensure these are available in your environment or adjust the relevant paths in the pipeline scripts.</p>
<p>🐳 Or Use Docker For reference, installation steps are also reflected in the Dockerfiles:</p>
<p>bash Copy Edit Dockerfile.pipeline1 Dockerfile.pipeline2 These show the exact installation process and can be adapted for manual setup if needed.</p>
</section>
</section>
</section>
<section id="software" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> software</h1>
<p>title: ” 🧰 Software Requirements (Non-Docker Setup)”</p>
<section id="software-requirements-non-docker-setup-1" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="software-requirements-non-docker-setup-1"><span class="header-section-number">13.1</span> 🧰 Software Requirements (Non-Docker Setup)</h2>
<p>If you’re running the pipeline without Docker, your system must have the following tools installed and available in your PATH — except for picard.jar and qualimap, which are already bundled in the pipeline under tools/ and should remain there.</p>
<section id="core-requirements" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="core-requirements"><span class="header-section-number">13.1.1</span> 📦 Core Requirements</h3>
<p>Install the following tools via your package manager (<code>apt</code>, <code>brew</code>, <code>conda</code>, etc.) or from source as needed:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 26%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Tool</th>
<th>Minimum Version</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bash</code></td>
<td>4.0+</td>
<td>Shell scripting</td>
</tr>
<tr class="even">
<td><code>cutadapt</code></td>
<td>4.0+</td>
<td>Adapter trimming</td>
</tr>
<tr class="odd">
<td><code>bwa</code></td>
<td>0.7.17+</td>
<td>Read alignment</td>
</tr>
<tr class="even">
<td><code>samtools</code></td>
<td>1.14+</td>
<td>BAM/SAM manipulation</td>
</tr>
<tr class="odd">
<td><code>picard</code></td>
<td>2.26.10+</td>
<td>BAM post-processing</td>
</tr>
<tr class="even">
<td><code>macs3</code></td>
<td>3.0.0a6+</td>
<td>Peak calling</td>
</tr>
<tr class="odd">
<td><code>homer</code></td>
<td>v4.11+</td>
<td>Alternative peak calling</td>
</tr>
<tr class="even">
<td><code>python3</code></td>
<td>3.9+</td>
<td>Used for helper scripts</td>
</tr>
<tr class="odd">
<td><code>pip</code></td>
<td>Latest</td>
<td>Python package management</td>
</tr>
<tr class="even">
<td><code>R</code></td>
<td>4.2+</td>
<td>Statistical computing environment</td>
</tr>
<tr class="odd">
<td><code>Rscript</code></td>
<td>4.2+</td>
<td>Script execution for R modules</td>
</tr>
<tr class="even">
<td><code>bedtools</code></td>
<td>2.30.0+</td>
<td>Genomic interval operations</td>
</tr>
<tr class="odd">
<td><code>deepTools</code></td>
<td>3.5.1+</td>
<td>QC and coverage tools</td>
</tr>
<tr class="even">
<td><code>idr</code></td>
<td>2.0.4.2 (patched)</td>
<td>Peak reproducibility scoring</td>
</tr>
<tr class="odd">
<td><code>jq</code></td>
<td>1.6+</td>
<td>JSON parsing (metadata scripts)</td>
</tr>
<tr class="even">
<td><code>wget</code>/<code>curl</code></td>
<td>any</td>
<td>Data downloading</td>
</tr>
<tr class="odd">
<td><code>yq</code></td>
<td>4.0+</td>
<td>YAML parsing and editing (Go-based)</td>
</tr>
</tbody>
</table>
</section>
<section id="required-python-packages" class="level3" data-number="13.1.2">
<h3 data-number="13.1.2" class="anchored" data-anchor-id="required-python-packages"><span class="header-section-number">13.1.2</span> 📚 Required Python Packages</h3>
<p>Install with:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install numpy pandas pyyaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="required-r-packages" class="level3" data-number="13.1.3">
<h3 data-number="13.1.3" class="anchored" data-anchor-id="required-r-packages"><span class="header-section-number">13.1.3</span> 📚 Required R Packages</h3>
<p>Your pipeline includes scripts that require the following <strong>CRAN</strong> and <strong>Bioconductor</strong> packages:</p>
<section id="from-cran" class="level4" data-number="13.1.3.1">
<h4 data-number="13.1.3.1" class="anchored" data-anchor-id="from-cran"><span class="header-section-number">13.1.3.1</span> From CRAN:</h4>
<ul>
<li><code>dplyr</code></li>
<li><code>ggplot2</code></li>
<li><code>tidyr</code></li>
<li><code>data.table</code></li>
<li><code>readr</code></li>
<li><code>stringr</code></li>
<li><code>tools</code></li>
<li><code>jsonlite</code></li>
<li><code>httr</code></li>
</ul>
</section>
<section id="from-bioconductor" class="level4" data-number="13.1.3.2">
<h4 data-number="13.1.3.2" class="anchored" data-anchor-id="from-bioconductor"><span class="header-section-number">13.1.3.2</span> From Bioconductor:</h4>
<ul>
<li><code>clusterProfiler</code></li>
<li><code>enrichplot</code></li>
<li><code>ReactomePA</code></li>
<li><code>reactome.db</code></li>
<li><code>biomaRt</code></li>
<li><code>AnnotationDbi</code></li>
<li><code>org.Hs.eg.db</code></li>
<li><code>org.Mm.eg.db</code></li>
</ul>
<blockquote class="blockquote">
<p>✅ The R scripts automatically attempt to install missing packages if your internet connection is available.</p>
</blockquote>
</section>
</section>
<section id="optional-for-full-compatibility" class="level3" data-number="13.1.4">
<h3 data-number="13.1.4" class="anchored" data-anchor-id="optional-for-full-compatibility"><span class="header-section-number">13.1.4</span> 🧬 Optional (for full compatibility)</h3>
<ul>
<li><code>FastQC</code></li>
<li><code>MultiQC</code></li>
<li><code>IGV</code> (for manual visualization)</li>
<li><code>docker</code> (if you’d like to use pre-built containers)</li>
</ul>
</section>
</section>
</section>
<section id="troubleshooting" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> troubleshooting</h1>
<p>title: “Troubleshooting” ❗ <strong>Troubleshooting / FAQ”</strong></p>
<ol type="1">
<li><p>🔍 Metadata Validation Fails</p></li>
<li><p>🛑 IDR Errors: NumPy or Missing Peaks</p></li>
<li><p>⚠️ Docker Mount Issues Troubleshooting &amp; FAQ **</p></li>
<li><p>🔍 Metadata Validation Fails</p></li>
<li><p>🛑 IDR Errors: NumPy or Missing Peaks 4.3 ⚠️ Docker Mount Issues</p></li>
</ol>
</section>
<section id="citations" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> citations</h1>
<p>title: “📚 Tool Citations”</p>
<p>We respectfully acknowledge the following software used in this pipeline:</p>
<ul>
<li><strong>Cutadapt</strong> — Martin (2011) <a href="https://doi.org/10.14806/ej.17.1.200">DOI: 10.14806/ej.17.1.200</a><br>
</li>
<li><strong>BWA</strong> — Li and Durbin (2009) <a href="https://pubmed.ncbi.nlm.nih.gov/19451168/">PMID: 19451168</a><br>
</li>
<li><strong>SAMtools</strong> — Li et al.&nbsp;(2009) <a href="https://pubmed.ncbi.nlm.nih.gov/19505943/">PMID: 19505943</a><br>
</li>
<li><strong>MACS3</strong> — Zhang et al.&nbsp;(2008) <a href="https://pubmed.ncbi.nlm.nih.gov/18798982/">PMID: 18798982</a><br>
</li>
<li><strong>HOMER</strong> — Heinz et al.&nbsp;(2010) <a href="https://pubmed.ncbi.nlm.nih.gov/20513432/">PMID: 20513432</a><br>
</li>
<li><strong>Picard</strong> — Broad Institute <a href="https://broadinstitute.github.io/picard/" class="uri">https://broadinstitute.github.io/picard/</a><br>
</li>
<li><strong>deepTools</strong> — Ramírez et al.&nbsp;(2016) <a href="https://pubmed.ncbi.nlm.nih.gov/27079975/">PMID: 27079975</a><br>
</li>
<li><strong>Qualimap</strong> — Okonechnikov et al.&nbsp;(2016) <a href="https://pubmed.ncbi.nlm.nih.gov/27040156/">PMID: 27040156</a><br>
</li>
<li><strong>IDR</strong> — Li et al.&nbsp;(2011) <a href="https://pubmed.ncbi.nlm.nih.gov/21300883/">PMID: 21300883</a><br>
</li>
<li><strong>clusterProfiler</strong> — Yu et al.&nbsp;(2012) <a href="https://pubmed.ncbi.nlm.nih.gov/22455463/">PMID: 22455463</a><br>
</li>
<li><strong>ReactomePA</strong> — Yu and He (2016) <a href="https://pubmed.ncbi.nlm.nih.gov/27480138/">PMID: 27480138</a><br>
</li>
<li><strong>yq</strong> — Mike Farah (v4+), GitHub: <a href="https://github.com/mikefarah/yq" class="uri">https://github.com/mikefarah/yq</a></li>
</ul>
<p>And others listed in the software requirements section above.</p>
<blockquote class="blockquote">
<p>⚠️ For academic use, please cite the original tools if you rely on results from this pipeline.</p>
</blockquote>
</section>
<section id="license" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> license</h1>
<p>title: “📄 MIT License”</p>
</section>
<section id="mit-license" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> MIT License</h1>
<p>Copyright (c) 2025 Nancy Anderson</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy<br>
of this software and associated documentation files (the “Software”), to deal<br>
in the Software without restriction, including without limitation the rights<br>
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br>
copies of the Software, and to permit persons to whom the Software is<br>
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all<br>
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br>
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br>
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br>
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br>
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br>
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE<br>
SOFTWARE.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>