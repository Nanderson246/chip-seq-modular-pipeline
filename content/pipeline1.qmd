---
title: "ğŸ”„ Pipeline 1: QC & Preprocessing Modules"
---

## ğŸ”„ Pipeline 1: QC & Preprocessing Modules

## ğŸ§¬ Supported Data Types

This pipeline is designed for **ChIP-seq** and **ATAC-seq** data preprocessing. It includes:

-   Adapter trimming (`cutadapt`)
-   Parallel quality control (`FastQC`)
-   Optional spike-in filtering
-   Mitochondrial read removal
-   Blacklist region filtering (ENCODE)
-   Clean alignment with BWA and BAM post-processing

By supporting these steps, the pipeline ensures high-quality, reproducible inputs for downstream peak calling or chromatin accessibility analysis.

> ğŸ” While optimized for ChIP-seq, the pipeline is fully compatible with ATAC-seq experiments.



Scripts: `01_init_directories.sh` to `11_Renaming_bam.sh`

``` bash
modules/pipeline1\$ tree . 
â”œâ”€â”€ 01_init_directories.sh 
â”œâ”€â”€ 02_reference_check.sh 
â”œâ”€â”€ 03_input_fetch.sh 
â”œâ”€â”€ 04_fastqc_parallel.sh 
â”œâ”€â”€ 05_05_Cutadapt_trimming_phix_parallel.sh 
â”œâ”€â”€ 06_fastqc_trimmed_parallel.sh 
â”œâ”€â”€ 07_spike_detect.sh 
â”œâ”€â”€ 08_alignment_bwa_spike.sh 
â”œâ”€â”€ 09_readgroups_add.sh 
â”œâ”€â”€ 10_bam_cleaning.sh 
â”œâ”€â”€ 10_plot_spike_qc_summary.R 
â””â”€â”€ 11_Renaming_bam.sh
```
Great structure! Given the flow of your Quarto document, the best place to add the **usage documentation** for `run_pipeline1.sh` would be **after** the `## ğŸ§¬ Supported Data Types` section and **before** the `### ğŸ”§ Modules` section.

This keeps your document logically organized:

1. **Intro**
2. **What data it supports**
3. **How to run it (Usage) âœ…**
4. **What each module does**
5. **What the outputs are**

---

### âœ… Suggested Update (add this block in your `.qmd` file):

````markdown
### ğŸš€ Usage: `run_pipeline1.sh`

This script is the entry point for Pipeline 1 and supports both default and customized executions.

#### âœ… Default Run

Run with all defaults:
```bash
bash run_pipeline1.sh
````

This uses:

* `THREADS = 4`
* `REFERENCE = hg38`
* `ADAPTER = tn5_truseq`
* `PLATFORM = ILLUMINA`
* `MAPPING = metadata/mapping.tsv`
* `REPORT_FORMAT = human`

#### ğŸ”§ Full Custom Run

Example of overriding all defaults:

```bash
bash run_pipeline1.sh -t 8 -r mm10 -a tn5_nextera -p IONTORRENT -m data/sample_metadata.tsv -f csv
```

Overrides:

* `-t 8`: 8 threads
* `-r mm10`: mouse genome
* `-a tn5_nextera`: alternative adapter
* `-p IONTORRENT`: sequencing platform
* `-m data/sample_metadata.tsv`: custom mapping file
* `-f csv`: report format

#### â„¹ï¸ Help

For option details:

```bash
bash run_pipeline1.sh --help
```


### ğŸ”§ Modules

```{r, echo=FALSE,  results='asis'}
library(knitr)
library(kableExtra)
library(magrittr)
modules <- data.frame(
  Script = c(
    "01_init_directories.sh",
    "02_reference_check.sh",
    "03_input_fetch.sh",
    "04_fastqc_parallel.sh",
    "05_Cutadapt_trimming_phix_parallel.sh",
    "06_fastqc_trimmed_parallel.sh",
    "07_spike_detect.sh",
    "08_alignment_bwa_spike.sh",
    "09_readgroups_add.sh",
    "10_bam_cleaning.sh",
    "11_Renaming_bam.sh"
  ),
  Purpose = c(
    "Creates necessary directory structure.",
    "Validates presence of genome reference files.",
    "Fetches and decompresses user-supplied FASTQ files.",
    "Runs FastQC and generates quality reports.",
    "Trims adapters and low-quality bases using Cutadapt.",
    "Runs FastQC on trimmed reads.",
    "Detects exogenous spike-in if not provided.",
    "Aligns reads using BWA and checks spike content.",
    "Adds read group metadata using Picard.",
    "Cleans and indexes BAMs; performs spike-in QC.",
    "Renames BAMs using mapping.tsv for grouping."
  )
)

table<- kable(modules, 
      format = "markdown",
      caption = "<strong>ğŸ”§ Modules Overview</strong>",
      align = c("l", "l")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"),    full_width = FALSE)
table

```

### ğŸ“ Output Folders

results/: Raw outputs and intermediate files.

analysis/Renamed_Cleaned: Cleaned and filtered BAMs for downstream usage.

results/

``` bash
results/Filtered$ tree 

â”œâ”€â”€ BAM}
â”œâ”€â”€ Filtered
â”œ        â”œâ”€â”€ Cleaned  âœ… here are the cleaned BAM that will be renamed. â”‚
â”œ        â”œâ”€â”€ Deduplicated
â”œ        â””â”€â”€ Metrics
â”œâ”€â”€ QC_fastqc
â”œâ”€â”€ QC_spike_plots
â”œâ”€â”€ QC_trimmed_fastqc
â”œâ”€â”€ spike_analysis
â””â”€â”€ Trimmed
```

------------------------------------------------------------------------

